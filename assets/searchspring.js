(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();let g;const d=new Uint8Array(16);function h(){if(!g&&(g=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!g))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return g(d)}const c=[];for(let n=0;n<256;++n)c.push((n+256).toString(16).slice(1));function p(n,e=0){return(c[n[e+0]]+c[n[e+1]]+c[n[e+2]]+c[n[e+3]]+"-"+c[n[e+4]]+c[n[e+5]]+"-"+c[n[e+6]]+c[n[e+7]]+"-"+c[n[e+8]]+c[n[e+9]]+"-"+c[n[e+10]]+c[n[e+11]]+c[n[e+12]]+c[n[e+13]]+c[n[e+14]]+c[n[e+15]]).toLowerCase()}const f=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),u={randomUUID:f};function w(n,e,t){if(u.randomUUID&&!e&&!n)return u.randomUUID();n=n||{};const r=n.random||(n.rng||h)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=r[s];return e}return p(r)}function m(n,e,t){let r="";if(t){const s=new Date;s.setTime(s.getTime()+t*24*60*60*1e3),r="; expires="+s.toUTCString()}document.cookie=n+"="+(e||"")+r+"; path=/"}function S(n){const e=document.cookie.match(new RegExp(n+"=([^;]+)"));return e?e[1]:null}async function l(){return await w()}class I{constructor(){}getSiteId(){return window.siteId}initialSearch(){const e=window.location.search;let t=window.searchspring||{};t.selectedValues={};let r=window.location.href;r=r.split("?"),r=r[0],r=r.split("/");const s=r[r.length-1];if(t.bgCollectionFilter=s,e){const o=new URLSearchParams(e).entries();for(const a of o)a[0].includes("filter.")?t.selectedValues[a[0]]?t.selectedValues[a[0]].push(a[1]):t.selectedValues[a[0]]=[a[1]]:t[a[0]]=a[1]}return t}warnVarError(e,t,r,s){console.warn(`Error on ${e}: ${t} must be one of ${r.join(", ")}. Provided value: `,s)}warnTypeError(e,t,r,s){console.warn(`Error on ${e}: ${t} must be a ${r}. Provided value: `,s)}warnClassError(e,t,r,s){console.warn(`Error on ${e}: ${t} must be an instance of ${r}. Provided value: `,s)}async getSearchspringUrl(e,t){(!e||e!=="search"&&e!=="autocomplete")&&this.warnVarError("getSearchspringUrl","pathname",["search","autocomplete"],e),t instanceof URLSearchParams||this.warnClassError("getSearchspringUrl",e,"URLSearchParams",t),t.append("resultsFormat","native"),t.append("redirectResponse","full"),t.append("domain",window.location.href);const r=await this.getSearchspringId("user");r&&t.append("userId",r),console.log(t.toString());const s=`&${t.toString()}`;return`https://${this.getSiteId()}.a.searchspring.io/api/search/${e}.json?siteId=${this.getSiteId()}${s}`}async setSearchspringId(e,t){if(!t||t!=="session"&&t!=="user"){this.warnVarError("setSearchspringId","type",["user","session"],t);return}if(typeof e!="string"){this.warnTypeError("setSearchspringId","id","string",e);return}const r=t==="user"?"ssUserId":"ssSesssionIdNamespace";try{m(r,e)}catch(s){console.warn("could not set searchspring session ID in Cookies",s)}}async getSearchspringId(e){(!e||e!=="session"&&e!=="user")&&this.warnVarError("getSearchspringId","type",["user","session"],e);let t;const r=e==="user"?"ssUserId":"ssSessionIdNamespace";try{t=S(r)}catch(s){console.warn(`Could not access sessionStorage to get searchspring id of type: ${e}`,s)}return t||(t=await l(),await this.setSearchspringId(t,e),t)}async getSearchspringHeaders(){const e=await this.getSearchspringId("user"),t=await this.getSearchspringId("session"),r=await l();return{Accept:"application/json","searchspring-user-id":e,"searchspring-session-id":t,"searchspring-page-load-id":r}}async getSearchspringConfig(){return{method:"GET",headers:await this.getSearchspringHeaders()}}async getSortOrder(e,t){return(!e||!(e instanceof URLSearchParams))&&(this.warnClassError("getSortOrder","params","sortOrder",e),e=new URLSearchParams),(!t||!t.field||typeof t.field!="string")&&this.warnTypeError("getSortOrder","sortOrder.field","string",t),(!t||!t.direction||t.direction!=="asc"&&t.direction!=="desc")&&this.warnVarError("getSortOrder","sortOrder.direction",["asc","desc"],t),t&&t.field&&t.direction&&e.append(`sort.${t.field}`,t.direction),e}async getActiveFilters(e,t){(!e||!(e instanceof URLSearchParams))&&(await this.warnClassError("getFacets","params","URLSearchParams",e),e=new URLSearchParams);for(const[r,s]of Object.entries(t))if(r==="ss_price"&&s&&s.length)e.append(`${r}.low`,s[0]),e.append(`${r}.high`,s[1]);else for(const i of s)e.append(`${r}`,i);return e}async getNormalizedResponse(e,t,r,s=""){return(!e||typeof e!="string")&&this.warnTypeError("getNormalizedResponse","url","string",e),(!t||typeof t!="object")&&this.warnTypeError("getNormalizedResponse","config","object: any",t),(!r||typeof r!="string")&&this.warnTypeError("getNormalizedResponse","searchQuery","string",e),await fetch(e,t).then(o=>o.json()).then(o=>(o&&o.sorting&&o.sorting.options&&o.sorting.options.length&&(o.sorting.options=o.sorting.options.map(a=>({...a,active:a.active===null||a.active===void 0?0:a.active}))),o)).catch(o=>(console.warn("Error fetching for",s,"searching ",r,"err: ",o),[]))}async getCollectionByHandle(e,t=null){(!e||typeof e!="string")&&this.warnTypeError("getCollectionByHandle","handle","string",e);let r=new URLSearchParams;r.append("bgfilter.collection_handle",e),t!=null&&t.sort&&(r=await this.getSortOrder(r,t.sort)),t!=null&&t.selectedValues&&(r=await this.getActiveFilters(r,t.selectedValues)),t!=null&&t.page&&(r=this.getPage(r,t.page)),t!=null&&t.perPage&&r.append("resultsPerPage",t.perPage);const s=await this.getSearchspringUrl("search",r),i=await this.getSearchspringConfig();return await this.getNormalizedResponse(s,i,e,"getCollectionByHandle")}async getSearchResults(e,t,r){(!e||typeof e!="string")&&this.warnTypeError("getSearchResults","searchQuery","string",e),(!t||t!=="autocomplete"&&t!=="search")&&this.warnClassError("getSearchResults","searchType",["autocomplete","search"],t);let s=new URLSearchParams;e&&s.append("q",e),r&&(r.sort&&(s=await this.getSortOrder(s,r.sort)),r.selectedValues&&(s=await this.getActiveFilters(s,r.selectedValues)),r.page&&(s=this.getPage(s,r.page)),r.tag&&s.append("tag",r.tag),r.oq&&s.append("oq",r.oq),r.perPage?s.append("resultsPerPage",r.perPage):s.append("resultsPerPage",4));const i=await this.getSearchspringUrl(t,s),o=await this.getSearchspringConfig();return this.getNormalizedResponse(i,o,e,t)}getPage(e,t){return e.append("page",t),e}async getFilters(e){const t=e.find(r=>r&&r.field&&r.field.toLowerCase().includes("size"));return t&&(t.values=t.values.sort((r,s)=>{const i=r.value,o=s.value;return parseInt(i)===parseInt(o)&&(isNaN(i)||isNaN(o))?i<o?-1:1:parseInt(i)<parseInt(o)?-1:1})),e}async search(e,t="search"){let r=null;e.selectedValues||(e.selectedValues={}),t!=="autocomplete"&&t!=="search"&&(t="search"),r=await this.getSearchResults(e.searchQuery,t,e);const s=r&&r.merchandising&&r.merchandising.redirect;return s&&window.location.replace(s),{products:r.results,filters:await this.getFilters(r.facets),sorting:r.sorting,pagination:r.pagination,merchandising:r.merchandising,breadcrumbs:r.breadcrumbs}}async getSuggestion(e){const t=this.getSiteId(),r=`https://${t}.a.searchspring.io/api/suggest/query?siteId=${t}&query=${e}&language=en&suggestionCount=4&&productCount=5`;return fetch(r)}async getRecommended(e){const t=this.getSiteId(),r=new URLSearchParams;r.append("siteId",t),e.productId&&r.append("product",e.productId),e.lastViewed&&r.append("lastViewed",e.lastViewed),e.tags&&r.append("tags",e.tags),e.limits&&r.append("limits",e.limits),e.cart&&r.append("cart",e.cart),e.shopper&&r.append("shopper",e.shopper);const s=`https://${t}.a.searchspring.io/boost/${t}/recommend?${r}`;return fetch(s).then(i=>i.json())}}(async function(){console.log("init searchspring getter"),window.getSearchspringService=()=>new I})();
